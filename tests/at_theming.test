<?php

class At_Theming_TestCase extends DrupalWebTestCase {
  public function getInfo() {
    return array(
      'name' => 'AT Theming',
      'description' => 'Make sure at_theming module is working correctly.',
      'group' => 'AT Theming',
    );
  }

  protected function setUp() {
    parent::setUp('atest_theming');
  }

  public function testViewRenderClass() {
    print_r(array(
      '___DEBUG___'
      'atest_theming' => module_enabled('atest_theming'),
      'atest_theming' => module_enabled('at_theming'),
    ));

    // Not sure why test modules are not enabled on setUp
    module_enable(array('atest_theming', 'at_theming'));

    print_r(array(
      '___DEBUG___'
      'atest_theming' => module_enabled('atest_theming'),
      'atest_theming' => module_enabled('at_theming'),
    ));

    $template_file = drupal_get_path('module', 'atest_theming') . '/templates/users.tpl.php';
    $view_name = 'atest_theming_user';
    $display_id = 'default';

    $output = at_id(new \Drupal\at_theming\ViewRender($template_file, $view_name, $display_id))->render();
    $this->assertTrue(preg_match('/UID: \d+/', $output));
  }

  public function testTwigRender() {
    $template_file = drupal_get_path('module', 'atest_theming') . '/templates/hello.twig';
    $output = at_theming_render_template($template_file, array('name' => 'Andy Truong'));
    $this->assertTrue(strpos($output, 'Hello Andy Truong') !== FALSE);

    // with drupalView filter
    $template_file = '@atest_theming/twig/views/simple.html.twig';
    $output = at_theming_render_template($template_file);
    $this->assertTrue(strpos($output, '>1</a>') !== FALSE);

    // with drupalBlock filter
    $template_file = '@atest_theming/twig/block.html.twig';
    $output = at_theming_render_template($template_file);
    $this->assertTrue(strpos($output, 'Powered by') !== FALSE);
  }
}
